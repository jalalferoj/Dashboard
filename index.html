<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Data Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary-color: #0d6efd;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #0dcaf0;
            --dark-bg: #121212;
            --card-bg: #1e1e1e;
            --border-color: #333;
        }

        body {
            padding: 20px;
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1a1a1a 100%);
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .navbar {
            background: rgba(30, 30, 30, 0.95) !important;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .chart-container {
            margin-top: 30px;
            position: relative;
        }

        canvas {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.3em;
        }

        .alert {
            border-radius: 10px;
            border: none;
        }

        .btn {
            border-radius: 10px;
            padding: 10px 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .form-control, .form-select {
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            color: #fff;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
            background: var(--card-bg);
            color: #fff;
        }

        .data-preview {
            max-height: 300px;
            overflow-y: auto;
            background: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid var(--border-color);
        }

        .table-dark {
            --bs-table-bg: var(--card-bg);
            --bs-table-border-color: var(--border-color);
        }

        .modal-content {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 15px;
        }

        .modal-header {
            border-bottom: 1px solid var(--border-color);
        }

        .modal-footer {
            border-top: 1px solid var(--border-color);
        }

        .progress {
            height: 8px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-chart-line me-2"></i>Dynamic Data Dashboard
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <button class="btn btn-outline-light btn-sm" id="exportBtn" title="Export Dashboard" disabled>
                            <i class="fas fa-download"></i>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container" style="margin-top: 80px;">
        <!-- Header Section -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="text-center mb-4 fade-in">
                    <i class="fas fa-chart-bar me-3"></i>Dynamic Data Visualization
                </h1>
                <p class="text-center text-muted">Upload your data and create custom charts</p>
            </div>
        </div>

        <!-- File Upload Section -->
        <div class="card mb-4 fade-in">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-upload me-2"></i>Data Upload
                </h5>
                <div class="row">
                    <div class="col-md-12">
                        <label for="fileInput" class="form-label">Upload CSV, TXT, or Excel File</label>
                        <input class="form-control" type="file" id="fileInput" accept=".csv,.txt,.xlsx">
                        <div class="form-text">Any structured data file is supported. The system will read the headers.</div>
                    </div>
                </div>

                <div class="progress mt-3" id="uploadProgress" style="display: none;">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                </div>

                <div class="loading-spinner" id="loadingSpinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Processing...</span>
                    </div>
                    <p class="mt-3">Processing your data...</p>
                </div>

                <div id="dataPreview" class="data-preview" style="display: none;">
                    <h6>Data Preview (First 10 rows)</h6>
                    <div class="table-responsive">
                        <table class="table table-dark table-sm" id="previewTable">
                            <thead></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dynamic Chart Generation -->
        <div id="dynamicChartControls" class="card mb-4 fade-in" style="display: none;">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-magic me-2"></i> Create Your Own Chart</h5>
                <div class="row g-3 align-items-end">
                    <div class="col-md-4">
                        <label for="columnSelect" class="form-label">Select Data Column</label>
                        <select id="columnSelect" class="form-select"></select>
                    </div>
                    <div class="col-md-3">
                        <label for="chartTypeSelect" class="form-label">Select Chart Type</label>
                        <select id="chartTypeSelect" class="form-select">
                            <option value="bar">Bar Chart</option>
                            <option value="pie">Pie Chart</option>
                            <option value="doughnut">Doughnut Chart</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="colorScheme" class="form-label">Color Scheme</label>
                        <select class="form-select" id="colorScheme">
                            <option value="default">Default</option>
                            <option value="pastel">Pastel</option>
                            <option value="vibrant">Vibrant</option>
                            <option value="monochrome">Monochrome</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button id="generateChartBtn" class="btn btn-primary w-100">
                            <i class="fas fa-plus me-1"></i> Generate
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dynamic Chart Display Area -->
        <div id="chartDisplayArea" class="row row-cols-1 row-cols-md-2 g-4">
            <!-- Dynamically generated charts will be appended here -->
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal fade" id="exportModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-download me-2"></i>Export Dashboard
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Exporting the entire dashboard is not yet supported in this version.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables and configuration
        let currentData = [];
        let charts = {};
        let settings = {
            colorScheme: 'default'
        };
        let chartCounter = 0;

        // Color schemes
        const colorSchemes = {
            default: ['#0d6efd', '#198754', '#ffc107', '#dc3545', '#6f42c1', '#fd7e14', '#20c997', '#e83e8c'],
            pastel: ['#a8e6cf', '#ffd3a5', '#fd9853', '#a8e6cf', '#dcedc1', '#ffd3a5', '#ffaaa5', '#ff8b94'],
            vibrant: ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff', '#5f27cd'],
            monochrome: ['#2c3e50', '#34495e', '#7f8c8d', '#95a5a6', '#bdc3c7', '#ecf0f1', '#e74c3c', '#c0392b']
        };

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
        });

        function initializeEventListeners() {
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);
            document.getElementById('exportBtn').addEventListener('click', () => {
                new bootstrap.Modal(document.getElementById('exportModal')).show();
            });
            document.getElementById('generateChartBtn').addEventListener('click', generateChartFromSelection);
            document.getElementById('colorScheme').addEventListener('change', () => {
                settings.colorScheme = document.getElementById('colorScheme').value;
            });
        }

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            showLoading(true);
            showProgress(true);

            // Reset UI
            document.getElementById('dynamicChartControls').style.display = 'none';
            document.getElementById('chartDisplayArea').innerHTML = '';
            document.getElementById('dataPreview').style.display = 'none';
            charts = {};
            chartCounter = 0;


            const reader = new FileReader();

            if (file.name.endsWith('.xlsx')) {
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const sheetName = workbook.SheetNames[0];
                        const sheet = workbook.Sheets[sheetName];
                        const json = XLSX.utils.sheet_to_json(sheet);
                        processData(json);
                    } catch (error) {
                        showAlert('Error reading Excel file: ' + error.message, 'danger');
                        showLoading(false);
                    }
                };
                reader.readAsArrayBuffer(file);
            } else {
                Papa.parse(file, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        if (results.errors.length > 0) {
                            showAlert('Error parsing file: ' + results.errors[0].message, 'warning');
                        }
                        processData(results.data);
                    },
                    error: function(error) {
                        showAlert('Error reading file: ' + error.message, 'danger');
                        showLoading(false);
                    }
                });
            }
        }

        function processData(data) {
            if (!data || data.length === 0) {
                showAlert('No data found in the file', 'warning');
                showLoading(false);
                return;
            }

            currentData = data;

            showDataPreview(data);
            populateColumnSelector(data);

            document.getElementById('dynamicChartControls').style.display = 'block';
            document.getElementById('exportBtn').disabled = false;

            showLoading(false);
            showProgress(false);
            showAlert('Data processed successfully! Now create your charts.', 'success');
        }

        function populateColumnSelector(data) {
            const select = document.getElementById('columnSelect');
            select.innerHTML = '';
            const headers = Object.keys(data[0]);
            headers.forEach(header => {
                const option = document.createElement('option');
                option.value = header;
                option.textContent = header;
                select.appendChild(option);
            });
        }

        function generateChartFromSelection() {
            const selectedColumn = document.getElementById('columnSelect').value;
            const chartType = document.getElementById('chartTypeSelect').value;

            if (!selectedColumn) {
                showAlert('Please select a column to visualize.', 'warning');
                return;
            }

            const chartData = generateChartData(currentData, selectedColumn);

            renderDynamicChart(selectedColumn, chartType, chartData);
        }

        function generateChartData(data, column) {
            const counts = {};
            data.forEach(row => {
                const value = row[column] || 'N/A';
                counts[value] = (counts[value] || 0) + 1;
            });
            return counts;
        }

        function renderDynamicChart(columnName, chartType, dataObj) {
            chartCounter++;
            const canvasId = `dynamicChart-${chartCounter}`;

            const chartWrapper = document.createElement('div');
            chartWrapper.className = 'col';
            chartWrapper.innerHTML = `
                <div class="card">
                    <div class="card-body">
                        <canvas id="${canvasId}"></canvas>
                    </div>
                </div>
            `;
            document.getElementById('chartDisplayArea').appendChild(chartWrapper);

            const ctx = document.getElementById(canvasId).getContext('2d');

            const dataKeys = Object.keys(dataObj);
            const dataValues = Object.values(dataObj);

            if (dataKeys.length === 0) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#fff';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No Data Available', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }

            const colors = getColorScheme();

            const config = {
                type: chartType,
                data: {
                    labels: dataKeys,
                    datasets: [{
                        label: `Count of ${columnName}`,
                        data: dataValues,
                        backgroundColor: colors.map(color => color + '80'),
                        borderColor: colors,
                        borderWidth: 2,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: chartType === 'pie' || chartType === 'doughnut',
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: `Distribution by ${columnName}`,
                            color: '#fff',
                            font: { size: 16, weight: 'bold' }
                        }
                    },
                    scales: chartType !== 'pie' && chartType !== 'doughnut' ? {
                        x: { ticks: { color: '#fff' }, grid: { color: '#333' } },
                        y: { ticks: { color: '#fff' }, grid: { color: '#333' } }
                    } : {}
                }
            };

            charts[canvasId] = new Chart(ctx, config);
        }

        function getColorScheme() {
            return colorSchemes[settings.colorScheme] || colorSchemes.default;
        }

        function showLoading(show) {
            document.getElementById('loadingSpinner').style.display = show ? 'block' : 'none';
        }

        function showProgress(show) {
            const progress = document.getElementById('uploadProgress');
            progress.style.display = show ? 'block' : 'none';
            if (show) {
                progress.querySelector('.progress-bar').style.width = '0%';
                setTimeout(() => progress.querySelector('.progress-bar').style.width = '100%', 200);
            }
        }

        function showDataPreview(data) {
            const preview = document.getElementById('dataPreview');
            const table = document.getElementById('previewTable');
            table.querySelector('thead').innerHTML = '';
            table.querySelector('tbody').innerHTML = '';

            const headers = Object.keys(data[0]);
            const headerRow = document.createElement('tr');
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            table.querySelector('thead').appendChild(headerRow);

            const previewData = data.slice(0, 10);
            previewData.forEach(row => {
                const tr = document.createElement('tr');
                headers.forEach(header => {
                    const td = document.createElement('td');
                    td.textContent = row[header] || '';
                    tr.appendChild(td);
                });
                table.querySelector('tbody').appendChild(tr);
            });

            preview.style.display = 'block';
        }

        function showAlert(message, type = 'info') {
            const alertContainer = document.querySelector('.container');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '80px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '1050';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            alertContainer.appendChild(alertDiv);

            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>
